(function(){"use strict";var i=function(n){var t=function(t,i){this.el=n(t),this.zoomFactor=1,this.lastScale=1,this.offset={x:0,y:0},this.options=n.extend({},this.defaults,i),this.setupMarkup(),this.bindEvents(),this.update(),this.enable()},i=function(t,i){return t+i};t.prototype={defaults:{tapZoomFactor:2,zoomOutFactor:1.3,animationDuration:300,maxZoom:4,minZoom:.5,lockDragAxis:!1,use2d:!0,zoomStartEventName:"pz_zoomstart",zoomEndEventName:"pz_zoomend",dragStartEventName:"pz_dragstart",dragEndEventName:"pz_dragend",doubleTapEventName:"pz_doubletap"},handleDragStart:function(t){this.el.trigger(this.options.dragStartEventName),this.stopAnimation(),this.lastDragPosition=!1,this.hasInteraction=!0,this.handleDrag(t)},handleDrag:function(t){if(1<this.zoomFactor){var i=this.getTouches(t)[0];this.drag(i,this.lastDragPosition),this.offset=this.sanitizeOffset(this.offset),this.lastDragPosition=i}},handleDragEnd:function(){this.el.trigger(this.options.dragEndEventName),this.end()},handleZoomStart:function(t){this.el.trigger(this.options.zoomStartEventName),this.stopAnimation(),this.lastScale=1,this.nthZoom=0,this.lastZoomCenter=!1,this.hasInteraction=!0},handleZoom:function(t,i){var n=this.getTouchCenter(this.getTouches(t)),o=i/this.lastScale;this.lastScale=i,this.nthZoom+=1,3<this.nthZoom&&(this.scale(o,n),this.drag(n,this.lastZoomCenter)),this.lastZoomCenter=n},handleZoomEnd:function(){this.el.trigger(this.options.zoomEndEventName),this.end()},handleDoubleTap:function(t){var i=this.getTouches(t)[0],n=1<this.zoomFactor?1:this.options.tapZoomFactor,o=this.zoomFactor,e=function(t){this.scaleTo(o+t*(n-o),i)}.bind(this);this.hasInteraction||(n<o&&(i=this.getCurrentZoomCenter()),this.animate(this.options.animationDuration,e,this.swing),this.el.trigger(this.options.doubleTapEventName))},sanitizeOffset:function(t){var i=(this.zoomFactor-1)*this.getContainerX(),n=(this.zoomFactor-1)*this.getContainerY(),o=Math.max(i,0),e=Math.max(n,0),s=Math.min(i,0),a=Math.min(n,0);return{x:Math.min(Math.max(t.x,s),o),y:Math.min(Math.max(t.y,a),e)}},scaleTo:function(t,i){this.scale(t/this.zoomFactor,i)},scale:function(t,i){t=this.scaleZoomFactor(t),this.addOffset({x:(t-1)*(i.x+this.offset.x),y:(t-1)*(i.y+this.offset.y)})},scaleZoomFactor:function(t){var i=this.zoomFactor;return this.zoomFactor*=t,this.zoomFactor=Math.min(this.options.maxZoom,Math.max(this.zoomFactor,this.options.minZoom)),this.zoomFactor/i},drag:function(t,i){i&&(this.options.lockDragAxis?Math.abs(t.x-i.x)>Math.abs(t.y-i.y)?this.addOffset({x:-(t.x-i.x),y:0}):this.addOffset({y:-(t.y-i.y),x:0}):this.addOffset({y:-(t.y-i.y),x:-(t.x-i.x)}))},getTouchCenter:function(t){return this.getVectorAvg(t)},getVectorAvg:function(t){return{x:t.map(function(t){return t.x}).reduce(i)/t.length,y:t.map(function(t){return t.y}).reduce(i)/t.length}},addOffset:function(t){this.offset={x:this.offset.x+t.x,y:this.offset.y+t.y}},sanitize:function(){this.zoomFactor<this.options.zoomOutFactor?this.zoomOutAnimation():this.isInsaneOffset(this.offset)&&this.sanitizeOffsetAnimation()},isInsaneOffset:function(t){var i=this.sanitizeOffset(t);return i.x!==t.x||i.y!==t.y},sanitizeOffsetAnimation:function(){var i=this.sanitizeOffset(this.offset),n=this.offset.x,o=this.offset.y,t=function(t){this.offset.x=n+t*(i.x-n),this.offset.y=o+t*(i.y-o),this.update()}.bind(this);this.animate(this.options.animationDuration,t,this.swing)},zoomOutAnimation:function(){var i=this.zoomFactor,n=this.getCurrentZoomCenter(),t=function(t){this.scaleTo(i+t*(1-i),n)}.bind(this);this.animate(this.options.animationDuration,t,this.swing)},updateAspectRatio:function(){this.setContainerY(this.getContainerX()/this.getAspectRatio())},getInitialZoomFactor:function(){return this.container[0].offsetWidth/this.el[0].offsetWidth},getAspectRatio:function(){return this.el[0].offsetWidth/this.el[0].offsetHeight},getCurrentZoomCenter:function(){var t=this.container[0].offsetWidth*this.zoomFactor,i=this.offset.x,n=t-i-this.container[0].offsetWidth,o=i/n,e=o*this.container[0].offsetWidth/(o+1),s=this.container[0].offsetHeight*this.zoomFactor,a=this.offset.y,h=s-a-this.container[0].offsetHeight,r=a/h,f=r*this.container[0].offsetHeight/(r+1);return 0===n&&(e=this.container[0].offsetWidth),0===h&&(f=this.container[0].offsetHeight),{x:e,y:f}},canDrag:function(){return t=this.zoomFactor,!((i=1)-.01<t&&t<i+.01);var t,i},getTouches:function(t){var i=this.container.offset();return Array.prototype.slice.call(t.touches).map(function(t){return{x:t.pageX-i.left,y:t.pageY-i.top}})},animate:function(n,o,e,s){var a=(new Date).getTime(),h=function(){if(this.inAnimation){var t=(new Date).getTime()-a,i=t/n;n<=t?(o(1),s&&s(),this.update(),this.stopAnimation(),this.update()):(e&&(i=e(i)),o(i),this.update(),requestAnimationFrame(h))}}.bind(this);this.inAnimation=!0,requestAnimationFrame(h)},stopAnimation:function(){this.inAnimation=!1},swing:function(t){return-Math.cos(t*Math.PI)/2+.5},getContainerX:function(){return this.container[0].offsetWidth},getContainerY:function(){return this.container[0].offsetHeight},setContainerY:function(t){return this.container.height(t)},setupMarkup:function(){this.container=n('<div class="pinch-zoom-container"></div>'),this.el.before(this.container),this.container.append(this.el),this.container.css({overflow:"hidden",position:"relative"}),this.el.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%",position:"absolute"})},end:function(){this.hasInteraction=!1,this.sanitize(),this.update()},bindEvents:function(){o(this.container.get(0),this),n(window).on("resize",this.update.bind(this)),n(this.el).find("img").on("load",this.update.bind(this))},update:function(){this.updatePlaned||(this.updatePlaned=!0,setTimeout(function(){this.updatePlaned=!1,this.updateAspectRatio();var t=this.getInitialZoomFactor()*this.zoomFactor,i=-this.offset.x/t,n=-this.offset.y/t,o="scale3d("+t+", "+t+",1) translate3d("+i+"px,"+n+"px,0px)",e="scale("+t+", "+t+") translate("+i+"px,"+n+"px)",s=function(){this.clone&&(this.clone.remove(),delete this.clone)}.bind(this);!this.options.use2d||this.hasInteraction||this.inAnimation?(this.is3d=!0,s(),this.el.css({"-webkit-transform":o,"-o-transform":e,"-ms-transform":e,"-moz-transform":e,transform:o})):(this.is3d&&(this.clone=this.el.clone(),this.clone.css("pointer-events","none"),this.clone.appendTo(this.container),setTimeout(s,200)),this.el.css({"-webkit-transform":e,"-o-transform":e,"-ms-transform":e,"-moz-transform":e,transform:e}),this.is3d=!1)}.bind(this),0))},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}};var o=function(t,e){var s=null,n=0,o=null,a=null,i=function(t,i){if(s!==t){if(s&&!t)switch(s){case"zoom":e.handleZoomEnd(i);break;case"drag":e.handleDragEnd(i)}switch(t){case"zoom":e.handleZoomStart(i);break;case"drag":e.handleDragStart(i)}}s=t},h=function(t){2===n?i("zoom"):1===n&&e.canDrag()?i("drag",t):i(null,t)},r=function(t){return Array.prototype.slice.call(t).map(function(t){return{x:t.pageX,y:t.pageY}})},f=function(t,i){var n,o;return n=t.x-i.x,o=t.y-i.y,Math.sqrt(n*n+o*o)},c=function(t){t.stopPropagation(),t.preventDefault()},u=!0;t.addEventListener("touchstart",function(t){e.enabled&&(u=!0,n=t.touches.length,function(t){var i=(new Date).getTime();if(1<n&&(o=null),i-o<300)switch(c(t),e.handleDoubleTap(t),s){case"zoom":e.handleZoomEnd(t);break;case"drag":e.handleDragEnd(t)}1===n&&(o=i)}(t))}),t.addEventListener("touchmove",function(t){if(e.enabled){if(u)h(t),s&&c(t),a=r(t.touches);else{switch(s){case"zoom":e.handleZoom(t,(i=a,n=r(t.touches),o=f(i[0],i[1]),f(n[0],n[1])/o));break;case"drag":e.handleDrag(t)}s&&(c(t),e.update())}u=!1}var i,n,o}),t.addEventListener("touchend",function(t){e.enabled&&(n=t.touches.length,h(t))})};return t};"undefined"!=typeof define&&define.amd?define(["jquery"],function(t){return i(t)}):(window.RTP=window.RTP||{},window.RTP.PinchZoom=i(window.$))}).call(this);